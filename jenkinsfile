pipeline{
    agent any
    stages{

        stage("Clone repo"){
            steps{
                git branch: 'main', url: 'https://github.com/vishnu721/devops.git'
            }            
        }
        
        stage('Provision Ec2 instance'){
            steps {
                
                sh "terraform init"
                sh "terraform plan"
            }
        }

        stage('Approval'){
            steps{
                script{
                    def userInput = input(id: 'confirm', message: 'Apply Terraform?', parameters: [ [$class: 'BooleanParameterDefinition', defaultValue: false, description: 'Apply terraform', name: 'confirm'] ])    
                }
            }
        }

        stage("Apply Terraform"){
            steps{
                sh "terraform apply -input=false"
            }
        }

        stage("Read TF Output"){
            steps{
                sh "terraform output -raw private_ip"
            }
        }
      
    }
}
